<script lang="ts" context="module">
  import type { Meta } from '@storybook/svelte';

  import CodeBlock from '$lib/holocene/code-block.svelte';

  export const meta = {
    title: 'Code Block',
    args: {
      editable: false,
      inline: false,
      language: 'json',
      copyable: false,
    },
    argTypes: {
      editable: {
        control: 'boolean',
        table: { category: 'Properties' },
      },
      inline: {
        control: 'boolean',
        table: { category: 'Properties' },
      },
      copyable: {
        control: 'boolean',
        table: { category: 'Properties' },
      },
      content: {
        control: 'text',
        table: { category: 'Content' },
      },
      language: {
        control: 'select',
        options: ['json', 'shell', 'text'],
        table: { category: 'Content' },
      },
      minHeight: {
        control: { type: 'number', min: 0, max: 9999, step: 1 },
        table: { category: 'Size' },
      },
      maxHeight: {
        control: { type: 'number', min: 0, max: 9999, step: 1 },
        table: { category: 'Size' },
      },
      copyIconTitle: {
        control: 'text',
        table: { category: 'Copy Icon' },
      },
      copySuccessIconTitle: {
        control: 'text',
        table: { category: 'Copy Icon' },
      },
    },
  } satisfies Meta<CodeBlock>;
</script>

<script lang="ts">
  import { action } from '@storybook/addon-actions';
  import { Story, Template } from '@storybook/addon-svelte-csf';

  import { stringifyWithBigInt } from '$lib/utilities/parse-with-big-int';
</script>

<Template id="json" let:args>
  <CodeBlock
    language="json"
    copyIconTitle="Click to copy content"
    copySuccessIconTitle="Content copied to clipboard"
    {...args}
    on:change={action('change')}
  />
</Template>

<Template id="shell" let:args>
  <CodeBlock
    language="shell"
    copyIconTitle="Click to copy content"
    copySuccessIconTitle="Content copied to clipboard"
    {...args}
    on:change={action('change')}
  />
</Template>

<Template id="text" let:args>
  <CodeBlock
    language="text"
    copyIconTitle="Click to copy content"
    copySuccessIconTitle="Content copied to clipboard"
    {...args}
    on:change={action('change')}
  />
</Template>

<Template let:args>
  <CodeBlock {...args} />
</Template>

<Story
  name="Default"
  args={{
    content: stringifyWithBigInt({ hello: 'world' }, null, 2),
  }}
/>

<Story
  name="Editable"
  args={{
    editable: true,
    content: stringifyWithBigInt({ hello: 'world' }, null, 2),
  }}
/>

<Story
  name="Inline"
  args={{
    inline: true,
    content: stringifyWithBigInt({ hello: 'world' }, null, 2),
  }}
/>

<Story
  name="Copyable"
  args={{
    copyable: true,
    content: stringifyWithBigInt({ hello: 'world' }, null, 2),
  }}
/>

<Story
  name="Minimum Height"
  args={{
    minHeight: 400,
    content: stringifyWithBigInt({ hello: 'world' }, null, 2),
  }}
/>

<Story
  name="Maximum Height"
  args={{
    maxHeight: 100,
    content: stringifyWithBigInt(
      Object.getOwnPropertyDescriptors(Array.prototype),
      null,
      2,
    ),
  }}
/>

<Story
  name="Shell"
  args={{
    language: 'shell',
    content: 'echo "Hello, World!"',
  }}
/>

<Story
  name="Text"
  args={{
    language: 'text',
    content: 'Hello, World!',
  }}
/>

<Story
  name="Copyable (Shell)"
  args={{
    language: 'shell',
    copyable: true,
    content: 'echo "Hello, World!"',
  }}
/>

<Story
  name="Copyable (Text)"
  args={{
    language: 'text',
    copyable: true,
    content: 'Hello, World!',
  }}
/>

<Story
  name="Copyable (Dark)"
  args={{
    language: 'json',
    copyable: true,
    content: stringifyWithBigInt({ hello: 'world' }, null, 2),
  }}
  parameters={{
    themes: {
      themeOverride: 'dark',
    },
  }}
/>
